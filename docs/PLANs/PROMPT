```markdown
### ðŸ“‹ NotebookLM Master Prompt: The Antigravity IDE Planner

**Role & Objective:**
Act as a **Senior DevOps & Full-Stack Architect** specializing in the "E-coma" codebase (Next.js 15, TypeScript, Supabase, Tailwind CSS). You are the bridge between the conceptual "Algerian Cash-Cycle" architecture and the actual execution in the IDE.

**Context:**
We are refactoring the E-coma webapp from a generic SaaS structure to an **Operations-First Algerian E-commerce Platform**. The new architecture prioritizes "Confirmation," "Logistics," and "Cash Recovery" over standard metrics, reflecting the local market realities (COD, high returns, informal exchange rates).

**Input Data:**
1.  **The New Sitemap:** A 7-page flow: `Research -> Marketing -> Confirmation -> Logistics -> Finance -> Growth -> Admin`.
2.  **Technical Documentation:** Existing file structure in `src/app`, component locations (e.g., `src/app/sales-dashboard/_components/`), and Supabase schema.

**Task:**
Execute a comprehensive refactoring of the codebase. You must move existing components to new directories, update all import paths, and scaffold new "Algerian-Specific" features.

---

#### 1. The Context Header
*   **Tech Stack:** Next.js 15 (App Router), TypeScript, Supabase (Auth/DB), Tailwind CSS, Shadcn/Radix UI.
*   **Refactoring Goal:** "Refactor the `src/app` directory to match the 'Algerian Order Lifecycle' architecture. Move from functional grouping (e.g., `/analytics`) to operational grouping (e.g., `/confirmation`, `/logistics`)."

#### 2. The "Move" Manifest (Refactoring Plan)
*Execute the following file moves and update all relative imports (`../../`) to absolute paths (`@/components/...`) where possible.*

**A. From `/sales-dashboard` (Legacy) to `/confirmation` (New Hub):**
*   Move `src/app/sales-dashboard/_components/CustomerBlacklist.tsx` â†’ `src/app/confirmation/_components/risk/CustomerBlacklist.tsx`.
*   Move `src/app/sales-dashboard/_components/ReturnRiskCalculator.tsx` â†’ `src/app/confirmation/_components/risk/ReturnRiskCalculator.tsx`.
*   Move `src/app/sales-dashboard/_components/ConfirmationWorkflow.tsx` â†’ `src/app/confirmation/_components/workflow/ConfirmationWorkflow.tsx`.
*   Move `src/app/sales-dashboard/_components/CallCenterScripts.tsx` â†’ `src/app/confirmation/_components/workflow/CallScripts.tsx`.
*   Extract "Wilaya Risk Map" logic from `RisqueClientsTab.tsx` â†’ Create `src/app/confirmation/_components/validation/WilayaValidator.tsx`.

**B. From `/sales-dashboard` & `/analytics` to `/logistics` (New Hub):**
*   Move `src/app/ecommerce/_components/delivery/ShipmentTracker.tsx` â†’ `src/app/logistics/_components/tracking/ShipmentTracker.tsx`.
*   Move `src/app/ecommerce/_components/inventory/CarrierComparison.tsx` â†’ `src/app/logistics/_components/shipping/CarrierComparison.tsx`.
*   Move `src/app/stock/_components/tabs/SitesRetoursTab.tsx` content â†’ `src/app/logistics/_components/returns/ReturnsManager.tsx`.

**C. From `/analytics` to `/finance` (New Hub):**
*   Move `src/app/analytics/_components/CashCollector.tsx` â†’ `src/app/finance/_components/cashflow/CashCollector.tsx`.
*   Move `src/app/analytics/_components/ProfitCalculator.tsx` â†’ `src/app/finance/_components/profitability/ProfitCalculator.tsx`.
*   Move `src/app/analytics/_components/IFUCalculator.tsx` â†’ `src/app/finance/_components/legal/IFUCalculator.tsx`.

**D. Strategic Relocations:**
*   Move `src/app/analytics/_components/CurrencyTracker.tsx` â†’ `src/app/sourcing/_components/costing/CurrencyTracker.tsx` (Context: Exchange rates are needed during sourcing, not just reporting).
*   Move `src/app/sales-dashboard/_components/OfflineConversionSync.tsx` â†’ `src/app/ads/_components/data/OfflineConversionSync.tsx` (Context: Align with Ads Manager).

#### 3. The "Build" Manifest (New Features Scaffolding)
*Create the following UI shells (placeholders) with TypeScript interfaces:*

1.  **`AutoEntrepreneurTaxCalc.tsx`**
    *   **Location:** `src/app/finance/_components/legal/`
    *   **Logic:** Input `Annual Revenue`; toggle `Services` (0.5% tax) vs `Goods` (0.5% tax). Display "Tax to Pay".
2.  **`BaridimobReceiptScanner.tsx`**
    *   **Location:** `src/app/confirmation/_components/payment/`
    *   **UI:** File upload zone for screenshots + Status badge "Pending Verification".
3.  **`DeliveryRateKPI.tsx`**
    *   **Location:** `src/app/ads/_components/metrics/`
    *   **Logic:** Formula = `(Delivered Orders / Total Confirmed Orders) * 100`.
4.  **`BulkLabelPrint.tsx`**
    *   **Location:** `src/app/logistics/_components/actions/`
    *   **UI:** Table selection checkbox + Button "Print Yalidine Labels (Batch)".

#### 4. Database & API Implications
*Draft a Supabase migration file `supabase/migrations/20240520_algerian_features.sql`:*

```sql
-- For Baridimob Verification
ALTER TABLE orders ADD COLUMN payment_proof_url TEXT;
ALTER TABLE orders ADD COLUMN payment_method_type TEXT CHECK (payment_method_type IN ('cod', 'baridimob', 'cib'));

-- For Risk Management
ALTER TABLE customers ADD COLUMN is_blacklisted BOOLEAN DEFAULT FALSE;
ALTER TABLE customers ADD COLUMN blacklist_reason TEXT;
ALTER TABLE customers ADD COLUMN wilaya_code VARCHAR(2);

-- For Finance (Auto-Entrepreneur)
ALTER TABLE merchants ADD COLUMN tax_regime TEXT CHECK (tax_regime IN ('classic', 'auto_entrepreneur', 'reel'));

-- For Sourcing (Square Exchange Rate)
ALTER TABLE settings ADD COLUMN currency_exchange_rate_square DECIMAL(10, 2);
```

#### 5. Safety Guardrails

* **DO NOT DELETE** any logic or original components. If a file seems redundant, move it to `src/app/_deprecated/` instead of deleting.
* **Layout Preservation:** Ensure `layout.tsx` files are created for the new directories (`/confirmation`, `/logistics`) to maintain the sidebar/header structure.
* **Import Fixes:** Automatically scan for broken imports caused by moving files and fix them using alias paths (`@/`).

```
